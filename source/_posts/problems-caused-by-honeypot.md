---
title: problems-caused-by-honeypot
tags: []
toc: true
mathjax: true
date: 2021-07-02 11:26:16
categories:
---
一次蜜罐引起的漏洞误报排查

主机上明明没有数据库，安全扫描结果却提示有数据库漏洞。之前作为误报反馈给安全同事处理，但是换了个安全软件又扫出了漏洞，直觉上认为一定有问题，决定排查一下。

问题现象
安全扫描结果显示主机上有 3306 端口想关的数据库漏洞。

排查思路
由于无法展示实际排查信息，如下仅从技术角度复现排查思路。

端口确认
通过如下多个命令，并没有发现主机上有监听 3306 端口。

1
2
netstat -anp | grep 3306
ss -ltanp | grep 3306
模拟扫描
扫描报告里有 nmap 的结果，显示有 3306 相关信息，因此决定通过如下 nmap 命令扫描下。

1
2
3
4
5
nmap 127.0.0.1 -p 3306

# x.x.x.36 表示管理IP
nmap x.x.x.36 -p 3306
nmap x.x.x.37 -p 3306
有如下发现。

在主机36或37上扫描本机 3306 端口，结果显示 closed

在主机36上扫描37，结果显示 3306 端口是 open 的

在主机37上扫描36，结果显示 3306 端口是 open 的

问题分析
如上现象比较奇怪，一是主机上明明没有listen 3306端口，但是 nmap 扫描结果却显示端口是 open 的，甚至使用 telnet mysql 客户端也能正常访问到服务。

一开始怀疑可能是IP冲突，导致扫描实际连到其它主机去了，经过一翻排查，也无法证明这个假设。

结合对 netfilter 的了解，想着会不会是 iptables 规则做了什么转发，于执行了如下命令，发现果然有一条规则对 3306 做了 DAT，判断这应该就是问题所在。

1
iptables -t nat -nL
因为这条规则将对本机 3306 的访问转发到了另一个IP和端口，因此又执行了如下命令，判断这个路由是怎么走的。

1
route -n
结果显示这条路由是经由一个 ppp0 的设备出去了，判断这是一个 ppp 协议的隧道设备，通过如下命令找到了对应的进程，最终发现是个蜜罐探针进程。

1
2
netstat -antup
ps aux | grep tun
到这里已经确定并没有实际的漏洞，而是为了做安全防护故意部署了蜜罐探针，目的就是故意伪装漏洞，诱骗攻击者，消耗攻击者的精力并收集信息。

蜜罐技术
蜜罐技术本质上是一种对攻击方进行欺骗的技术，通过布置一些作为诱饵的主机、网络服务或者信息，诱使攻击方对它们实施攻击，从而可以对攻击行为进行捕获和分析，了解攻击方所使用的工具与方法，推测攻击意图和动机，能够让防御方清晰地了解他们所面对的安全威胁，并通过技术和管理手段来增强实际系统的安全防护能力。